## Сервис для работы с продажами магазинов

Запуск тестов: make test\
Сборка docker-образа: make docker\
Запуск в контейнере: make run

## Оптимизация хранилища для получения агрегированной информации о продажах магазина за период.

### 0. Baseline
Самым простым решением для хранения продаж будет простой массив, хранящий структуры с данными продаж всех магазинов.
Примем такое решение за baseline и попробуем его оптимизировать.

### 1. Шардирование по магазину на основе map
Наиболее очевидная оптимизация. Хранить массивы продаж отдельно для каждого магазина в map-е, у которой ключом является ID магазина.

### 2. Сохранение разреженного индекса
Предположим, что последовательные события о продажах в рамках одного магазина имеют неубывающие отметки времени.
Тогда для более быстрого поиска искомых продаж внутри заданного временного интервала можно строить разреженный индекс 
с некоторой заданной гранулярностью. Например, можно хранить временную метку каждого 100-ого события. В дальнейшем для 
заданного интервала можем быстро найти 2 гранулы по 100 элементов, в которых уже перебором найти 2 искомые 
продажи (с которой начать и на которой закончить подсчет)

### 3. Хранение кумулятивной суммы продаж для каждой новой продажи
Разреженный индекс будет терять эффективность с увеличением запрашиваемого временного интервала, потому что внутри интервала
все равно придется перебирать все продажи для подсчета. Эту проблему можно решить, если накапливать кумулятивную сумму продаж для
каждой новой продажи. 

КумулятивнаяСуммаТекущейПродажи = КумулятивнаяСуммаПредыдущейПродажи + СуммаТекущейПродажи

Пример.

**Sale1**  qty: 1, price: 1     sum =      1 * 1 = 1\
**Sale2**  qty: 1, price: 5     sum = 1  + 1 * 5 = 6\
**Sale3**  qty: 3, price: 2     sum = 6  + 3 * 2 = 12\
**Sale4**  qty: 2, price: 5     sum = 12 + 2 * 5 = 22

Таким образом:\
СуммаПродажЗаПериод = КумулятивнаяСуммаНаКонецПериода - КумулятивнаяСуммаНаНачалоПериода
КумулятивнаяСуммаНаКонецПериода - кумулятивная сумма последней продажи в периоде
КумулятивнаяСуммаНаНачалоПериода - кумулятивная сумма первой продажи слева от начала периода

Такой подход дает возможность избавиться от перебора продаж внутри временного интервала при подсчете суммы продаж.

**Итог**

Performance-тест показывает ускорение до 20 раз при получении общей суммы продаж на больших наборах данных.
